<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration Form Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .test-result {
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 0.5rem;
            font-family: monospace;
        }
        .success { background-color: #d1fae5; border: 1px solid #10b981; color: #065f46; }
        .error { background-color: #fee2e2; border: 1px solid #ef4444; color: #991b1b; }
        .info { background-color: #dbeafe; border: 1px solid #3b82f6; color: #1e40af; }
    </style>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-900 mb-8">Registration Form API Tests</h1>
        
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">Test Results</h2>
            <div id="test-results"></div>
            <button onclick="runTests()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 mt-4">
                Run Tests
            </button>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">Manual Form Test</h2>
            <p class="text-gray-600 mb-4">Use this form to manually test the registration functionality:</p>
            
            <form id="registration-form" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                        <select name="title" class="w-full px-3 py-2 border border-gray-300 rounded-sm">
                            <option value="">Select Any</option>
                            <option value="Dr">Dr</option>
                            <option value="Mr">Mr</option>
                            <option value="Ms">Ms</option>
                            <option value="Mrs">Mrs</option>
                            <option value="Prof">Prof</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                        <input type="text" name="firstName" value="John" class="w-full px-3 py-2 border border-gray-300 rounded-sm" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                        <input type="text" name="lastName" value="Doe" class="w-full px-3 py-2 border border-gray-300 rounded-sm" required>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" name="email" value="john.doe@example.com" class="w-full px-3 py-2 border border-gray-300 rounded-sm" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                        <input type="tel" name="phoneNumber" value="+1234567890" class="w-full px-3 py-2 border border-gray-300 rounded-sm" required>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Country</label>
                        <select name="country" class="w-full px-3 py-2 border border-gray-300 rounded-sm" required>
                            <option value="">Select country</option>
                            <option value="United States">United States</option>
                            <option value="Canada">Canada</option>
                            <option value="United Kingdom">United Kingdom</option>
                            <option value="Australia">Australia</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Abstract Category</label>
                        <select name="abstractCategory" class="w-full px-3 py-2 border border-gray-300 rounded-sm" required>
                            <option value="">Select Category</option>
                            <option value="Poster">Poster</option>
                            <option value="Oral">Oral</option>
                            <option value="Delegate">Delegate</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Full Postal Address</label>
                    <textarea name="fullPostalAddress" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-sm" required>123 Main Street, City, State, 12345</textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Registration Type</label>
                    <select name="selectedRegistration" class="w-full px-3 py-2 border border-gray-300 rounded-sm">
                        <option value="">Select Registration Type</option>
                        <option value="delegate_academia">Delegate (Academia)</option>
                        <option value="delegate_business">Delegate (Business)</option>
                        <option value="speaker_academia">Speaker (Academia)</option>
                        <option value="student">Student</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Number of Participants</label>
                    <select name="numberOfParticipants" class="w-full px-3 py-2 border border-gray-300 rounded-sm">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                    </select>
                </div>

                <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
                    Test Registration Submission
                </button>
            </form>

            <div id="form-result" class="mt-4"></div>
        </div>
    </div>

    <script>
        const BASE_URL = 'http://localhost:3000';

        function addResult(message, type = 'info') {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.textContent = message;
            resultsDiv.appendChild(resultDiv);
        }

        async function testAPI(endpoint, description) {
            try {
                addResult(`Testing ${description}...`, 'info');
                const response = await fetch(`${BASE_URL}${endpoint}`);
                
                if (response.ok) {
                    const data = await response.json();
                    addResult(`✅ ${description} - SUCCESS (${response.status}) - ${Array.isArray(data) ? data.length : 'N/A'} items`, 'success');
                    return { success: true, data };
                } else {
                    addResult(`❌ ${description} - FAILED (${response.status}): ${response.statusText}`, 'error');
                    return { success: false, error: response.statusText };
                }
            } catch (error) {
                addResult(`❌ ${description} - ERROR: ${error.message}`, 'error');
                return { success: false, error: error.message };
            }
        }

        async function runTests() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '';
            
            addResult('🚀 Starting Registration Form API Tests...', 'info');

            const tests = [
                { endpoint: '/api/registration/sponsorship-tiers', description: 'Sponsorship Tiers API' },
                { endpoint: '/api/registration/types', description: 'Registration Types API' },
                { endpoint: '/api/registration/accommodation', description: 'Accommodation Options API' }
            ];

            let successful = 0;
            const total = tests.length;

            for (const test of tests) {
                const result = await testAPI(test.endpoint, test.description);
                if (result.success) successful++;
            }

            addResult(`📊 Test Summary: ${successful}/${total} tests passed`, successful === total ? 'success' : 'error');
        }

        // Form submission test
        document.getElementById('registration-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            
            // Add required fields
            data.sponsorType = '';
            data.accommodationType = '';
            data.numberOfParticipants = parseInt(data.numberOfParticipants) || 1;
            data.registrationFee = 899;
            data.accommodationFee = 0;
            data.totalPrice = 899;
            data.pricingPeriod = 'spotRegistration';

            const resultDiv = document.getElementById('form-result');
            resultDiv.innerHTML = '<div class="test-result info">Submitting registration...</div>';

            try {
                const response = await fetch(`${BASE_URL}/api/registration`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    const result = await response.json();
                    resultDiv.innerHTML = `<div class="test-result success">✅ Registration submitted successfully! ID: ${result.registrationId}</div>`;
                } else {
                    const error = await response.text();
                    resultDiv.innerHTML = `<div class="test-result error">❌ Registration failed (${response.status}): ${error}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error">❌ Registration error: ${error.message}</div>`;
            }
        });

        // Auto-run tests on page load
        window.addEventListener('load', () => {
            setTimeout(runTests, 1000);
        });
    </script>
</body>
</html>
